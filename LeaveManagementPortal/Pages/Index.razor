@page "/"
@using LeaveManagementPortal.Models
@using LeaveManagementPortal.Services
@inject EmployeeService EmployeeService
@inject EmployeeProjectDetailsService ProjectDetailsService
@inject EmployeeLeaveDetailsService LeaveDetailsService
@inject NavigationManager Navigation

<PageTitle>Leave Management Portal</PageTitle>

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="jumbotron bg-primary text-white p-5 rounded">
                <h1 class="display-4">Welcome to Leave Management Portal</h1>
                <p class="lead">Manage employees, projects, and leave applications efficiently in one centralized system.</p>
                <hr class="my-4 bg-light">
                <p>Get started by exploring the different sections of the portal using the navigation menu.</p>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card bg-info text-white h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">Total Employees</h5>
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                    <h2 class="mb-3">@employeeCount</h2>
                    <div class="mt-auto">
                        <button class="btn btn-light" @onclick="NavigateToEmployees">
                            Manage Employees
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card bg-success text-white h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">Active Projects</h5>
                        <i class="fas fa-project-diagram fa-2x"></i>
                    </div>
                    <h2 class="mb-3">@activeProjectCount</h2>
                    <div class="mt-auto">
                        <button class="btn btn-light" @onclick="NavigateToProjects">
                            Manage Projects
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card bg-warning text-white h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">Pending Leaves</h5>
                        <i class="fas fa-calendar-times fa-2x"></i>
                    </div>
                    <h2 class="mb-3">@pendingLeaveCount</h2>
                    <div class="mt-auto">
                        <button class="btn btn-light" @onclick="NavigateToLeaves">
                            Manage Leaves
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" @onclick="NavigateToAddEmployee">
                            <i class="fas fa-user-plus"></i> Add New Employee
                        </button>
                        <button class="btn btn-success" @onclick="NavigateToAddProject">
                            <i class="fas fa-plus"></i> Assign Project
                        </button>
                        <button class="btn btn-warning" @onclick="NavigateToAddLeave">
                            <i class="fas fa-calendar-plus"></i> Apply for Leave
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">System Features</h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check-circle text-success"></i> Employee Management</li>
                        <li><i class="fas fa-check-circle text-success"></i> Project Assignment Tracking</li>
                        <li><i class="fas fa-check-circle text-success"></i> Leave Application Processing</li>
                        <li><i class="fas fa-check-circle text-success"></i> Leave Approval Workflow</li>
                        <li><i class="fas fa-check-circle text-success"></i> Search and Filter Options</li>
                        <li><i class="fas fa-check-circle text-success"></i> MongoDB Integration</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private int employeeCount = 0;
    private int activeProjectCount = 0;
    private int pendingLeaveCount = 0;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var employees = await EmployeeService.GetAllAsync();
            employeeCount = employees.Count;

            var activeProjects = await ProjectDetailsService.GetActiveProjectsAsync();
            activeProjectCount = activeProjects.Count;

            var pendingLeaves = await LeaveDetailsService.GetByStatusAsync(LeaveStatus.Pending);
            pendingLeaveCount = pendingLeaves.Count;
        }
        catch
        {
            // Handle errors silently for dashboard
            employeeCount = 0;
            activeProjectCount = 0;
            pendingLeaveCount = 0;
        }
    }

    private void NavigateToEmployees() => Navigation.NavigateTo("/employees");
    private void NavigateToProjects() => Navigation.NavigateTo("/project-details");
    private void NavigateToLeaves() => Navigation.NavigateTo("/leave-details");
    private void NavigateToAddEmployee() => Navigation.NavigateTo("/employees/add");
    private void NavigateToAddProject() => Navigation.NavigateTo("/project-details/add");
    private void NavigateToAddLeave() => Navigation.NavigateTo("/leave-details/add");
}
